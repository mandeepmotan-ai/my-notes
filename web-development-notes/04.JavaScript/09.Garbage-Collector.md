# Garbage Collector

## Garbage Collection

- as JS is a high level language, → memory allocation & deallocation is automatic
- the Garbage Collector (GC) frees up memory that’s no longer reachable in the program
- implemented using algorithms like Mark-and-Sweep

```jsx
let user = { name: "Mandeep" };
user = null; // old object becomes unreachable
// GC will eventually remove it from memory
```

## How GC works? (Mark-and-Sweep Algorithm)

1. GC starts from root objects (like window in browsers, global in Node.js)
2. It marks all reachable objects (variables, closures, references)
3. Anything not marked → considered garbage 
4. GC sweeps them → free memory

## Memory leaks in JS

- actually even with GC, memory leaks happen if we accidentally hold references to unused data

### Common causes for memory leaks:

1. **Global Variables**
    
    ```jsx
    function bad() {
      leakedVar = "oops"; // becomes global accidentally
    }
    ```
    
2. **Uncleared timers/intervals**
    
    ```jsx
    setInterval(() => {
      console.log("Still running...");
    }, 1000);
    // If not cleared → memory leak
    ```
    
3. **Event listeners removed**
    
    ```jsx
    document.getElementById("btn")
      .addEventListener("click", () => console.log("clicked"));
    // If element removed but listener not removed → leak
    ```
    
4. **Closures holding references** 
    
    ```jsx
    function outer() {
      let bigData = new Array(1000000);
      return function inner() {
        console.log(bigData.length);
      };
    }
    let leaky = outer(); // `bigData` never released
    ```
    

## **Best Practices to Avoid Memory Leaks**

- always use `let`/`const`, avoid accidental globals
- clear timers → `clearInterval()` / `clearTimeout()`
- remove event listeners when elements are removed
- break unnecessary references → `obj = null;`
- use WeakMap / WeakSet for objects that should not prevent GC

## **WeakMap & WeakSet (Special Structures)**

- Unlike normal Maps/Sets, they don’t **prevent GC**.
- If the object key/value becomes unreachable, it gets collected automatically.

```jsx
let weakMap = new WeakMap();
let user = { name: "Mandeep" };

weakMap.set(user, "some data");

user = null; // object becomes unreachable
// GC will clean it up from WeakMap automatically
```