# Reflow and Repaint

- while building dynamic websites performance is key, a laggy UI  or janky animation could easily kill the user experience
- To optimize this we must understand how the browser renders and what happens when we change the DOM or CSS
- and this is where **Reflow** (*layout recalculation*) and **Repaint** (*redrawing*) came in

## The Browser’s Rendering Pipeline

When a browser loads a page, it goes through these pages:

1. **Parse HTML** → Build DOM 
2. **Parse CSS** → Build CSSOM
3. **Build CSSOM + DOM** → to create the Render Tree (only visible elements, with computed style)
4. **Layout (Reflow phase)** → Browser calculates size, position, and geometry of each node (only visible element)
5. **Paint (Repaint phase)** → Browser fills pixels (text, color, images, shadows)
6. **Compositing** → Different layers merged into final screen output (handles z-index, transforms, opacity)

#NOTE: Every DOM or CSS change we make in JavaScript may trigger reflow or paint 

## Reflow

- reflow means **layout recalculation**
- it is the process of *browser’s recalculation of  geometry and position of element*
- **most expensive operation** in rendering pipeline
- this happens when a change affects the layout of an element, which may ripple through siblings, ancestors, or even the whole page

### Common Triggers of Reflow:

Any change that affects the size, position, or structure of an element will cause a reflow

- Adding/removing DOM nodes (`appendChild`, `removeChild`).
- Changing **layout-affecting CSS** (`width`, `height`, `margin`, `padding`, `border`, `display`, `position`).
- Changing **font size/family**.
- Changing element content (`innerText`, `innerHTML`).
- Window resize.
- Reading layout properties like `offsetHeight`, `offsetWidth`, `scrollHeight`, `getBoundingClientRect()`.
    - ⚡ These cause **forced reflow** → browser flushes pending changes to give accurate values.

## Repaint

- also known as **redraw ,** is the process of redrawing an element’s visual appearance without changing it’s layout
- it is less expensive than reflow as the browser doesn’t have to recalculate geometry of the page, but it still cost performance

### Common Triggers of Repaint:

Repaints are triggered by changes to visual properties that do not affect the element's position or size. Common triggers include:

- Changing `color`
- Changing `background-color` or `background-image`
- Changing `visibility`
- Changing `outline` or `box-shadow`
- Changing `border-color`

#NOTE: a repaint often happens after reflow because browser needs to redraw the elements with their new dimensions and positions 

## Best Practices (Pro-Level)

- **Batch DOM writes/reads** → don’t alternate them.
- **Use CSS classes** instead of multiple inline styles.
- **Use DocumentFragment** for bulk DOM inserts.
- **Prefer `transform` & `opacity`** for animations.
- **Avoid `table` layouts** → small changes cause massive reflows.
- **Throttle/debounce resize & scroll events**.
- **Use `requestAnimationFrame`** for animations (sync with browser repaint cycle).
- **Profile in DevTools** (Performance tab → look for “Layout” and “Paint” events).